# Stage 1: Build
FROM ubuntu:20.04 AS builder
RUN apt-get update && apt-get install -y \
    build-essential \
    cmake \
    git \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /src
# Copy your project files (adjust the COPY commands if your structure is different)
COPY . .

# Create a build directory and build the project.
RUN mkdir build && cd build && cmake .. && make

# Stage 2: Runtime container
FROM ubuntu:20.04
WORKDIR /src

# Copy the compiled binary from the builder stage.
COPY --from=builder /src/build/node1 .

# Expose the UDP port used by AODV (if needed)
EXPOSE 5555/udp

# Run the application.
ENTRYPOINT ["./node1"]
